<mat-form-field>
  <mat-label>Filtro</mat-label>
  <input matInput (keyup)="applyFilter($event)" placeholder="Buscar" #input />
</mat-form-field>

<table mat-table [dataSource]="dataSource" matSort multiTemplateDataRows>
  <ng-container matColumnDef="school">
    <th
      mat-header-cell
      *matHeaderCellDef
      mat-sort-header
      sortActionDescription="Ordenar por Escuela"
    >
      <p>Escuela</p>
    </th>
    <td mat-cell *matCellDef="let element">
      <p>{{ element.school }}</p>
    </td>
  </ng-container>

  <ng-container matColumnDef="instructor">
    <th
      mat-header-cell
      *matHeaderCellDef
      mat-sort-header
      sortActionDescription="Ordenar por Instructor"
    >
      <p>Instructor</p>
    </th>
    <td mat-cell *matCellDef="let element">
      <p>{{ element.instructor }}</p>
    </td>
  </ng-container>

  <ng-container matColumnDef="name">
    <th
      mat-header-cell
      *matHeaderCellDef
      mat-sort-header
      sortActionDescription="Ordenar por Nombre"
    >
      <p>Apellido y Nombre</p>
    </th>
    <td mat-cell *matCellDef="let element">
      <div class="name-info-box">
        <button
          mat-icon-button
          (click)="expanded = expanded === element ? null : element"
        >
          <i class="fa-solid fa-eye"></i>
        </button>
        <div class="word-companion-info">
          <p>{{ element.name }}</p>
        </div>
      </div>
    </td>
  </ng-container>

  <ng-container matColumnDef="is_dan">
    <th
      mat-header-cell
      *matHeaderCellDef
      mat-sort-header
      sortActionDescription="Ordenar por Categoría"
    >
      <p>Categoría</p>
    </th>
    <td mat-cell *matCellDef="let element">
      <p>@if (element.is_dan) { DAN } @else { COLOR }</p>
    </td>
  </ng-container>

  <ng-container matColumnDef="forms">
    <th mat-header-cell *matHeaderCellDef>
      <p>Formas</p>
    </th>
    <td mat-cell *matCellDef="let element">
      <div class="mydict">
        <div>
          @for (option of radioOptions; track option) {
          <label
            (click)="element.forms = option; calculateTotal($event, element)"
          >
            <input type="radio" [(ngModel)]="element.forms" [value]="option" />
            <span>{{ option }}</span>
          </label>
          }
        </div>
      </div>
    </td>
  </ng-container>

  <ng-container matColumnDef="combat">
    <th mat-header-cell *matHeaderCellDef>
      <p>Combate</p>
    </th>
    <td mat-cell *matCellDef="let element">
      <div class="mydict">
        <div>
          @for (option of radioOptions; track option) {
          <label
            (click)="element.combat = option; calculateTotal($event, element)"
          >
            <input type="radio" [(ngModel)]="element.combat" [value]="option" />
            <span>{{ option }}</span>
          </label>
          }
        </div>
      </div>
    </td>
  </ng-container>

  <ng-container matColumnDef="jump">
    <th mat-header-cell *matHeaderCellDef>
      <p>Salto en Alto</p>
    </th>
    <td mat-cell *matCellDef="let element">
      <div class="mydict">
        <div>
          @if (!element.is_dan) { @for (option of radioOptions; track option) {
          <label
            (click)="element.jump = option; calculateTotal($event, element)"
          >
            <input type="radio" [(ngModel)]="element.jump" [value]="option" />
            <span>{{ option }}</span>
          </label>
          } }
        </div>
      </div>
    </td>
  </ng-container>

  <ng-container matColumnDef="total">
    <th
      mat-header-cell
      *matHeaderCellDef
      mat-sort-header
      sortActionDescription="Ordenar por Total"
    >
      <p>TOTAL</p>
    </th>
    <td mat-cell *matCellDef="let element">
      <p>{{ element.total }}</p>
    </td>
  </ng-container>

  <!-- ---------- Expanded Detail ---------- -->

  <ng-container matColumnDef="expandedDetail">
    <td
      mat-cell
      *matCellDef="let element"
      [attr.colspan]="displayedColumns.length"
    >
      <div [@detailExpand]="element === expanded ? 'expanded' : 'collapsed'">
        <p>Edad: {{ element.age }}</p>
        <p>Cinturón: {{ element.belt }}</p>
      </div>
    </td>
  </ng-container>

  <tr mat-header-row *matHeaderRowDef="displayedColumns; sticky: true"></tr>

  <tr
    mat-row
    *matRowDef="let element; columns: displayedColumns"
    [class.expanded-row]="element.isExpanded"
    (click)="element.isExpanded = !element.isExpanded"
  ></tr>

  <tr
    mat-row
    *matRowDef="let row; columns: ['expandedDetail']"
    class="expanded"
  ></tr>

  <tr class="mat-row" *matNoDataRow>
    <td class="mat-cell" colspan="displayedColumns.length">{{ showError }}</td>
  </tr>
</table>

<mat-paginator
  [pageSize]="10"
  [pageSizeOptions]="[5, 10, 20, 50]"
  showFirstLastButtons
  aria-label="Seleccione la cantidad"
>
</mat-paginator>
